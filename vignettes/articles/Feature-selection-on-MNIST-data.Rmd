---
title: "Feature selection on MNIST data"
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(celavi)
```

```{r data}
library(dplyr)
library(klassets)

use_small_data <- TRUE

data <- klassets::mnist_train
data <- dplyr::mutate(data, label = factor(label))

test <- klassets::mnist_test
test <- dplyr::mutate(test, label = factor(label))


if(use_small_data){
  data <- dplyr::sample_n(data, 10000)
  data <- dplyr::select(data, c(1, sample(2:785, 100)))  
  test <- dplyr::sample_n(test, 1000)
}
```


```{r procedure}
x <- feature_selection(
  ranger::ranger,
  data = data,
  test = test,
  response = "label",
  stat = median,
  iterations = 25,
  sample_frac = .25,
  predict_function = function(object, newdata){ranger:::predict.ranger(object, data = newdata)$predictions},
  parallel = FALSE,
  max.depth = 10
)

x

plot(x)
```

